# map_viewer/mappings_and_rules.yaml
# Configuration for device-to-unit mapping, signal-based color rules, and XML parsing

default_color: "#D3D3D3"  # Light gray - default/neutral state

# XML Parsing Configuration
xml_parsing:
  # Attributes to extract from XML elements
  attributes_to_extract:
    - "type"
  
  # Child elements to extract from XML elements
  child_elements_to_extract:
    - "Text"
    - "Size"
    - "Location"
    - "UnitId"
    - "LineThick"
    - "FlowDirection"
    - "DashStyle"
    - "StartCap"
    - "EndCap"
    - "ForeColor"
    - "BeltDirection"
  
  # Types that should be rendered as text labels
  render_as_text_types:
    - "System.Windows.Forms.Label, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
  
  # Types that should be rendered as arrows
  render_as_arrow_types:
    - "SmartFactory.SmartCIM.GUI.Widgets.WidgetArrow, SmartFactory.SmartCIM.GUI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"
  
  # Types that should be rendered as rectangles with directional arrow overlays
  render_as_arrowed_rectangle_types:
    - "SmartFactory.SmartCIM.GUI.Widgets.WidgetBelt, SmartFactory.SmartCIM.GUI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"
  
  # Type-based color mapping (base colors, will be overridden by runtime state)
  type_color_mapping:
    default: "#D3D3D3"  # neutral base; runtime state will recolor
  
  # Type-based z-index mapping (rendering order)
  type_zindex_mapping:
    "SmartFactory.SmartCIM.GUI.Widgets.WidgetConveyorPort, SmartFactory.SmartCIM.GUI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null": 4
    "SmartFactory.SmartCIM.GUI.Widgets.WidgetBelt, SmartFactory.SmartCIM.GUI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null": 3
    "SmartFactory.SmartCIM.GUI.Widgets.WidgetDiverter, SmartFactory.SmartCIM.GUI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null": 2
    default: 0
  
  # ForeColor mapping (color name to QColor values)
  forecolor_mapping:
    HotTrack: "#0066CC"
    Black: "#000000"
    Red: "#FF0000"
    Green: "#00FF00"
    Blue: "#0000FF"
    Yellow: "#FFFF00"
    White: "#FFFFFF"
    default: "#000000"

# Device ID to UnitID mapping
# Maps device_id patterns (with wildcards) to UnitId values from the XML
device_to_unit:
  # Conveyor belts
  - pattern: "B1ACNV*@*"
    unit_id: "*"  # Use the prefix before @ as unit_id
  # Diverters
  - pattern: "B1ACDV*@*"
    unit_id: "*"
  # Ports
  - pattern: "B1ACPT*@*"
    unit_id: "*"

# Color rules based on signal values
# Each rule specifies: signal name, operator, value, resulting color, and priority
# Higher priority rules are evaluated first
#
# Rule fields:
#   - signal: name of the signal to monitor
#   - op: comparison operator (==, !=, >, <, >=, <=)
#   - value: value to compare against
#   - color: color to apply
#   - priority: rule priority (higher wins)
#   - target: "block" (default) or "arrow" - which part of arrowed rectangles to color
#
# Text overlay feature:
#   - text: single character to display (e.g., 'X' to cross out)
#   - text_color: color for the text overlay
#   - bg_color: background color (if not specified, uses 'color')

rules:
  # Status-based colors (highest priority)
  - signal: "Status"
    op: "=="
    value: "Running"
    color: "#00C853"  # Green - running
    priority: 100

  # Error status with red X overlay
  - signal: "Status"
    op: "=="
    value: "Error"
    bg_color: "#FFCCCC"  # Light red background
    text: "X"
    text_color: "#D50000"  # Dark red X to cross out
    priority: 100

  # Stopped status with pause symbol
  - signal: "Status"
    op: "=="
    value: "Stopped"
    bg_color: "#FFF9C4"  # Light yellow background
    text: "â€–"  # Pause symbol
    text_color: "#FF6F00"  # Dark orange
    priority: 100

  - signal: "Status"
    op: "=="
    value: "Idle"
    color: "#B0BEC5"  # Blue-gray - idle
    priority: 100

  # Signal A state colors
  - signal: "A"
    op: "=="
    value: 0
    color: "#ECEFF1"  # Very light gray
    priority: 10

  - signal: "A"
    op: "=="
    value: 1
    color: "#FFEB3B"  # Yellow
    priority: 10

  - signal: "A"
    op: "=="
    value: 2
    color: "#4CAF50"  # Green
    priority: 10

  - signal: "A"
    op: "=="
    value: 3
    color: "#2196F3"  # Blue
    priority: 10

  # Signal B threshold colors
  - signal: "B"
    op: ">"
    value: 80
    color: "#D50000"  # Red - high value
    priority: 50

  - signal: "B"
    op: ">"
    value: 50
    color: "#FF9800"  # Orange - medium-high
    priority: 40

  - signal: "B"
    op: ">"
    value: 20
    color: "#FFC107"  # Amber - medium
    priority: 30

  # Speed-based colors
  - signal: "Speed"
    op: ">"
    value: 1.0
    color: "#1976D2"  # Dark blue - fast
    priority: 20

  - signal: "Speed"
    op: ">"
    value: 0.5
    color: "#42A5F5"  # Light blue - medium
    priority: 15

  - signal: "Speed"
    op: ">"
    value: 0.0
    color: "#90CAF9"  # Very light blue - slow
    priority: 10
